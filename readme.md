# Установка NextCloud в Proxmox
Первоначальные требования:
-   Версия Proxmox 8.3.1
-   Операционая система в контейнере ubuntu-20.04-standart-amd64
-   установка Nextcloud будет производится через snap пакет
-   Подключение локальной папки через SSHFS

## Установка виртуальной машини в proxmox
1. Для создания контейнере нужно создать шаблон в разделе CT Templates на основе ubuntu-20.04-standart-amd64

2. Выбираем Local в меню "CT Templates" загружаем нужную ОС.\
![пример установки ОС](/image/Screenshot_20250219_205309.png)

3. После загрузки он отобразится в списке (см. первый сриншот)
4. Далее в левом верхнем углу появится кнопка:
![](/image/кнопка%20create%20VM.png)

5. Появится окно:
![](/image/1%20меню%20установки%20ос.png)

6. Заполняем Hostname и Password.Имя хоста указывается по вашему желанию. Пароль нужен будет для автоматизации в консоле контейнера.
7. Выбираем шаблон
![](/image/Tempalete.png)

8. В меню Диска выделяем размер дискового пространства(в размере требуемой работы).
![](/image/Disk.png)

9. Далее в меню СPU выбираем количество Ядра. Для работы nextcloud потребуется не меньше 4 ядер (это будет полезно при обработке фотографий). На ваше усмотрение Для запаса можно выделить 8 ядер.\
![](/image/CPU.png)

10. Выделяем для NextCloud оперативную память под 8Гб и не менее 5Гб же Подкачки (SWAP).
![](/image/MEMORY.png)

11. Задаем статический IP или используем DHCP сервер.
![](/image/NETWORK.png)

12. Вкладку DNS оставляем по умолчанию. И создаем контейнер. 
![](/image/DNS.png)

13. В меню потверждения нажимаем на finish и контейнер собирается.
![](/image/FINISH%20CT.png)

14. Выбираем наш Контейнер, заходим в Параметры и выбираем Возможности => Редактировать.
![](/image/options.png)

15. Здесь нам нужно включить FUSE и жмём ОК.\
![](/image/fetuears.png)

FUSE (англ. filesystem in userspace — «файловая система в пользовательском пространстве») — свободный модуль для ядер Unix-подобных операционных систем, позволяет разработчикам создавать новые типы файловых систем, доступные для монтирования пользователями без привилегий (прежде всего — виртуальных файловых систем).
 

## Установка Nextcloud на виртуальной машине
1. 3апускаем контейнер, в меню контайнера заходим в консоль и авторизовываемся:
![](/image/console.png)
2. В консоли вводим команду:

```Bash
apt update && apt upgrade -y
```
3. Теперь, когда CT обновлен, пришло время установить программное обеспечение, которое мы будем использовать для установки пакетов **snap** моментальных снимков. 
Для этого используйте команду:
```Bash
apt install squashfuse snapd -y
```
4. Используя пакетный менеджер **SNAP** мы будем устанавливать NextCloud: (Если с первого раза не запустилось, повторите команду снова):
```Bash
snap install nextcloud
```
![](/image/installnextcloud.png)

5. Теперь нам нужно добавить пользователя в систему:
```bash
adduser <username>
```
![](/image/adduser.png)

6. Добавляем пользователя в sudo группу:
```Bash
adduser <username> sudo
```
7. Создадим администратора NextCloud (Username и Пароль Я вводил того же пользователя, которого я создал):
```Bash
nextcloud.manual-install <username> <password>
```
8. Теперь нам нужно сообщить NextCloud, что мы можем доверять конкретному IP-адресу.
Смотрим его командой: ip address
```Bash
ip a
```
Убеждаемся что контейнер доступен по нем:
```Bash
nextcloud.occ config:system:set trusted_domains 1 --value=<ip a>
```
9. Можно добавить домен привязанный к вашему адресу. (привязать домен вы можете используя сервисы для DDNS, или имея белый адрес от провайдера - привязать просто к нему свой) :
```Bash
nextcloud.occ config:system:set trusted_domains 1 --value=example.com
```
> Использовать одновремено два адреса не получится. Поэтому либо внутренний адрес, либо домен. 

10. Конечный результат
![](/image/finishnextcloud2.png)